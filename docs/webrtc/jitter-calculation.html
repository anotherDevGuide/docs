<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jitter Calculation &mdash; WebRTC Docs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/style.css">
  <style>
    .diagram {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin: 24px 0;
      overflow-x: auto;
    }
    .diagram svg {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }
    .diagram-caption {
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 16px;
      font-style: italic;
    }
    .key-point {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      background: var(--accent-dim);
      border-radius: var(--radius);
      margin: 16px 0;
    }
    .key-point-icon {
      font-size: 1.2rem;
      line-height: 1;
    }
    .key-point p {
      margin: 0;
      color: var(--text);
    }
    .formula-box {
      background: var(--surface);
      border: 2px solid var(--accent);
      border-radius: var(--radius);
      padding: 24px;
      margin: 24px 0;
      text-align: center;
    }
    .formula-box .formula {
      font-family: var(--font-mono);
      font-size: 1.2rem;
      color: var(--accent);
      margin-bottom: 12px;
    }
    .formula-box .description {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    .step-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin: 16px 0;
    }
    .step-card h4 {
      color: var(--accent);
      font-size: 1rem;
      margin-bottom: 12px;
    }
    .step-card p {
      margin: 0;
      color: var(--text-muted);
    }
    .step-card .mono {
      font-family: var(--font-mono);
      color: var(--accent);
      background: var(--bg);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    .example-table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      font-size: 0.9rem;
    }
    .example-table th, .example-table td {
      padding: 10px 12px;
      border: 1px solid var(--border);
      text-align: center;
    }
    .example-table th {
      background: var(--surface);
      color: var(--text);
      font-weight: 600;
    }
    .example-table td {
      color: var(--text-muted);
    }
    .example-table .highlight {
      background: var(--accent-dim);
      color: var(--accent);
      font-weight: 500;
    }
  </style>
</head>
<body>

  <div class="container">
    <header class="doc-header">
      <a href="index.html">&larr; Back to all docs</a>
      <h1>Jitter Calculation</h1>
      <p class="subtitle">How WebRTC measures network jitter (RFC 3550)</p>
    </header>

    <article class="doc-content">

      <!-- ============================================ -->
      <!-- SECTION: What is Jitter -->
      <!-- ============================================ -->
      <h2>What is Jitter?</h2>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>Jitter</strong> = Variation in packet arrival times. Not the delay itself, but how much the delay <em>changes</em> between packets.</p>
      </div>

      <div class="diagram">
        <svg viewBox="0 0 800 220" xmlns="http://www.w3.org/2000/svg">
          <text x="400" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">Jitter = Variation in Arrival Times</text>
          
          <!-- Expected timeline -->
          <text x="50" y="70" fill="#8b90a0" font-size="11">Expected:</text>
          <line x1="120" y1="65" x2="750" y2="65" stroke="#4ade80" stroke-width="2"/>
          
          <!-- Expected packets (evenly spaced) -->
          <rect x="150" y="50" width="30" height="30" rx="4" fill="#4ade80"/>
          <text x="165" y="70" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P1</text>
          
          <rect x="300" y="50" width="30" height="30" rx="4" fill="#4ade80"/>
          <text x="315" y="70" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P2</text>
          
          <rect x="450" y="50" width="30" height="30" rx="4" fill="#4ade80"/>
          <text x="465" y="70" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P3</text>
          
          <rect x="600" y="50" width="30" height="30" rx="4" fill="#4ade80"/>
          <text x="615" y="70" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P4</text>
          
          <text x="165" y="100" text-anchor="middle" fill="#4ade80" font-size="9">0ms</text>
          <text x="315" y="100" text-anchor="middle" fill="#4ade80" font-size="9">20ms</text>
          <text x="465" y="100" text-anchor="middle" fill="#4ade80" font-size="9">40ms</text>
          <text x="615" y="100" text-anchor="middle" fill="#4ade80" font-size="9">60ms</text>
          
          <!-- Actual timeline -->
          <text x="50" y="150" fill="#8b90a0" font-size="11">Actual:</text>
          <line x1="120" y1="145" x2="750" y2="145" stroke="#f87171" stroke-width="2"/>
          
          <!-- Actual packets (unevenly spaced) -->
          <rect x="150" y="130" width="30" height="30" rx="4" fill="#6c9cfc"/>
          <text x="165" y="150" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P1</text>
          
          <rect x="330" y="130" width="30" height="30" rx="4" fill="#fbbf24"/>
          <text x="345" y="150" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P2</text>
          
          <rect x="420" y="130" width="30" height="30" rx="4" fill="#fbbf24"/>
          <text x="435" y="150" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P3</text>
          
          <rect x="650" y="130" width="30" height="30" rx="4" fill="#f87171"/>
          <text x="665" y="150" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">P4</text>
          
          <text x="165" y="180" text-anchor="middle" fill="#6c9cfc" font-size="9">0ms</text>
          <text x="345" y="180" text-anchor="middle" fill="#fbbf24" font-size="9">25ms</text>
          <text x="435" y="180" text-anchor="middle" fill="#fbbf24" font-size="9">35ms</text>
          <text x="665" y="180" text-anchor="middle" fill="#f87171" font-size="9">75ms</text>
          
          <!-- Jitter indicators -->
          <path d="M315 105 L345 125" stroke="#fbbf24" stroke-width="2" stroke-dasharray="4,2"/>
          <text x="340" y="115" fill="#fbbf24" font-size="9">+5ms</text>
          
          <path d="M465 105 L435 125" stroke="#fbbf24" stroke-width="2" stroke-dasharray="4,2"/>
          <text x="440" y="115" fill="#fbbf24" font-size="9">-5ms</text>
          
          <path d="M615 105 L665 125" stroke="#f87171" stroke-width="2" stroke-dasharray="4,2"/>
          <text x="650" y="115" fill="#f87171" font-size="9">+15ms</text>
          
          <!-- Legend -->
          <text x="400" y="210" text-anchor="middle" fill="#8b90a0" font-size="11">Jitter measures how much these differences vary</text>
        </svg>
        <p class="diagram-caption">Same packets, different arrival patterns - the variation is jitter</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: The Formula -->
      <!-- ============================================ -->
      <h2>The Formula (<a href="https://www.rfc-editor.org/rfc/rfc3550#section-6.4.1" target="_blank" rel="noopener" style="color: var(--accent);">RFC 3550</a>)</h2>

      <p>WebRTC uses the interarrival jitter formula from <a href="https://www.rfc-editor.org/rfc/rfc3550#section-6.4.1" target="_blank" rel="noopener">RFC 3550 Section 6.4.1</a>:</p>

      <div class="formula-box">
        <div class="formula">J(i) = J(i-1) + (|D(i-1,i)| - J(i-1)) / 16</div>
        <div class="description">Running average of packet arrival time differences</div>
      </div>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>In simple terms:</strong> New jitter = Old jitter + (<strong>|D|</strong> - old jitter) / 16</p>
      </div>

      <h3>What is "D" (the difference)?</h3>

      <p><strong>D</strong> measures how much a packet's arrival timing deviated from what was expected:</p>

      <div class="formula-box">
        <div class="formula">D = (Receive Interval) - (Send Interval)</div>
        <div class="description">D = (R<sub>i</sub> - R<sub>i-1</sub>) - (S<sub>i</sub> - S<sub>i-1</sub>)</div>
      </div>

      <div class="step-card">
        <h4>Breaking it down:</h4>
        <p><strong>Send Interval</strong> = Time between sender sending packet i-1 and packet i (e.g., 20ms)</p>
        <p style="margin-top: 8px;"><strong>Receive Interval</strong> = Time between receiver getting packet i-1 and packet i (e.g., 25ms)</p>
        <p style="margin-top: 8px;"><strong>D</strong> = 25ms - 20ms = <span class="mono">+5ms</span> (packet arrived 5ms later than expected)</p>
      </div>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>|D| means absolute value</strong> &mdash; We only care about the <em>magnitude</em> of the deviation, not whether it was early (-) or late (+). A packet arriving 5ms early or 5ms late both contribute equally to jitter.</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Step by Step -->
      <!-- ============================================ -->
      <h2>Step by Step</h2>

      <div class="diagram">
        <svg viewBox="0 0 800 360" xmlns="http://www.w3.org/2000/svg">
          <text x="400" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">How D(i-1, i) is Calculated</text>
          
          <!-- Sender side -->
          <rect x="50" y="60" width="300" height="120" rx="10" fill="#1a1d27" stroke="#4ade80" stroke-width="2"/>
          <text x="200" y="85" text-anchor="middle" fill="#4ade80" font-size="12" font-weight="600">SENDER</text>
          
          <text x="80" y="115" fill="#8b90a0" font-size="10">Packet i-1 sent at:</text>
          <text x="250" y="115" fill="#4ade80" font-size="11" font-weight="500">S(i-1) = 1000</text>
          
          <text x="80" y="145" fill="#8b90a0" font-size="10">Packet i sent at:</text>
          <text x="250" y="145" fill="#4ade80" font-size="11" font-weight="500">S(i) = 1020</text>
          
          <text x="200" y="170" text-anchor="middle" fill="#8b90a0" font-size="10">Send interval = 20ms</text>
          
          <!-- Arrow -->
          <path d="M350 120 L450 120" stroke="#8b90a0" stroke-width="2" marker-end="url(#arr1)"/>
          <text x="400" y="110" text-anchor="middle" fill="#8b90a0" font-size="10">Network</text>
          
          <!-- Receiver side -->
          <rect x="450" y="60" width="300" height="120" rx="10" fill="#1a1d27" stroke="#6c9cfc" stroke-width="2"/>
          <text x="600" y="85" text-anchor="middle" fill="#6c9cfc" font-size="12" font-weight="600">RECEIVER</text>
          
          <text x="480" y="115" fill="#8b90a0" font-size="10">Packet i-1 received at:</text>
          <text x="680" y="115" fill="#6c9cfc" font-size="11" font-weight="500">R(i-1) = 1050</text>
          
          <text x="480" y="145" fill="#8b90a0" font-size="10">Packet i received at:</text>
          <text x="680" y="145" fill="#6c9cfc" font-size="11" font-weight="500">R(i) = 1075</text>
          
          <text x="600" y="170" text-anchor="middle" fill="#8b90a0" font-size="10">Receive interval = 25ms</text>
          
          <!-- Calculation -->
          <rect x="150" y="210" width="500" height="130" rx="10" fill="#242836" stroke="#fbbf24" stroke-width="2"/>
          <text x="400" y="240" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="600">CALCULATE D(i-1, i)</text>
          
          <text x="180" y="270" fill="#8b90a0" font-size="11">D = (R(i) - R(i-1)) - (S(i) - S(i-1))</text>
          <text x="180" y="295" fill="#8b90a0" font-size="11">D = (1075 - 1050) - (1020 - 1000)</text>
          <text x="180" y="320" fill="#8b90a0" font-size="11">D = 25 - 20 =</text>
          <text x="305" y="320" fill="#4ade80" font-size="13" font-weight="600">5ms</text>
          
          <text x="480" y="285" fill="#8b90a0" font-size="10">Packet arrived</text>
          <text x="480" y="305" fill="#fbbf24" font-size="12" font-weight="500">5ms later than expected</text>
          
          <defs>
            <marker id="arr1" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#8b90a0"/>
            </marker>
          </defs>
        </svg>
        <p class="diagram-caption">D measures the difference between expected and actual arrival</p>
      </div>

      <div class="step-card">
        <h4>Step 1: Calculate Send Interval</h4>
        <p>Time between when sender sent packet i-1 and packet i</p>
        <p class="mono" style="margin-top: 8px;">S(i) - S(i-1) = Send Interval</p>
      </div>

      <div class="step-card">
        <h4>Step 2: Calculate Receive Interval</h4>
        <p>Time between when receiver got packet i-1 and packet i</p>
        <p class="mono" style="margin-top: 8px;">R(i) - R(i-1) = Receive Interval</p>
      </div>

      <div class="step-card">
        <h4>Step 3: Calculate Difference D</h4>
        <p>How much the receive interval differs from send interval</p>
        <p class="mono" style="margin-top: 8px;">D = Receive Interval - Send Interval</p>
      </div>

      <div class="step-card">
        <h4>Step 4: Update Jitter (Running Average)</h4>
        <p>Smooth the value using exponential moving average (factor of 16)</p>
        <p class="mono" style="margin-top: 8px;">J = J + (|D| - J) / 16</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Example Calculation -->
      <!-- ============================================ -->
      <h2>Example Calculation</h2>

      <p>Let's trace through several packets:</p>

      <table class="example-table">
        <thead>
          <tr>
            <th>Packet</th>
            <th>Send Time</th>
            <th>Receive Time</th>
            <th>D (difference)</th>
            <th>|D|</th>
            <th>Jitter (J)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>0</td>
            <td>50</td>
            <td>-</td>
            <td>-</td>
            <td>0</td>
          </tr>
          <tr>
            <td>2</td>
            <td>20</td>
            <td>75</td>
            <td class="highlight">+5ms</td>
            <td>5</td>
            <td>0 + (5-0)/16 = <strong>0.31</strong></td>
          </tr>
          <tr>
            <td>3</td>
            <td>40</td>
            <td>92</td>
            <td class="highlight">-3ms</td>
            <td>3</td>
            <td>0.31 + (3-0.31)/16 = <strong>0.48</strong></td>
          </tr>
          <tr>
            <td>4</td>
            <td>60</td>
            <td>125</td>
            <td class="highlight">+13ms</td>
            <td>13</td>
            <td>0.48 + (13-0.48)/16 = <strong>1.26</strong></td>
          </tr>
          <tr>
            <td>5</td>
            <td>80</td>
            <td>142</td>
            <td class="highlight">-3ms</td>
            <td>3</td>
            <td>1.26 + (3-1.26)/16 = <strong>1.37</strong></td>
          </tr>
        </tbody>
      </table>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>Notice:</strong> Jitter changes slowly (divided by 16). This smooths out spikes and gives a stable metric.</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Why Divide by 16 -->
      <!-- ============================================ -->
      <h2>Why Divide by 16?</h2>

      <div class="diagram">
        <svg viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg">
          <text x="400" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">Smoothing Factor: 1/16</text>
          
          <!-- Without smoothing -->
          <rect x="50" y="60" width="300" height="100" rx="10" fill="#1a1d27" stroke="#f87171" stroke-width="2"/>
          <text x="200" y="85" text-anchor="middle" fill="#f87171" font-size="11" font-weight="600">WITHOUT SMOOTHING</text>
          
          <!-- Spiky line -->
          <path d="M80 130 L120 90 L160 140 L200 85 L240 135 L280 95 L320 130" fill="none" stroke="#f87171" stroke-width="2"/>
          <text x="200" y="155" text-anchor="middle" fill="#8b90a0" font-size="9">Jumpy, hard to use</text>
          
          <!-- With smoothing -->
          <rect x="450" y="60" width="300" height="100" rx="10" fill="#1a1d27" stroke="#4ade80" stroke-width="2"/>
          <text x="600" y="85" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="600">WITH 1/16 SMOOTHING</text>
          
          <!-- Smooth line -->
          <path d="M480 120 L520 115 L560 118 L600 112 L640 116 L680 114 L720 115" fill="none" stroke="#4ade80" stroke-width="2"/>
          <text x="600" y="155" text-anchor="middle" fill="#8b90a0" font-size="9">Stable, reliable metric</text>
          
          <!-- Explanation -->
          <text x="400" y="185" text-anchor="middle" fill="#8b90a0" font-size="11">1/16 â‰ˆ 6% of new value mixed with 94% of old value</text>
        </svg>
        <p class="diagram-caption">Smoothing prevents single bad packets from skewing the metric</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Jitter Ranges -->
      <!-- ============================================ -->
      <h2>Jitter Ranges</h2>

      <div class="diagram">
        <svg viewBox="0 0 800 150" xmlns="http://www.w3.org/2000/svg">
          <text x="400" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">Jitter Quality Ranges</text>
          
          <!-- Scale bar background with rounded corners -->
          <rect x="100" y="60" width="600" height="30" rx="6" fill="#242836"/>
          
          <!-- Clip path for rounded corners on the entire bar -->
          <defs>
            <clipPath id="barClip">
              <rect x="100" y="60" width="600" height="30" rx="6"/>
            </clipPath>
          </defs>
          
          <!-- Zones clipped to the rounded bar shape -->
          <g clip-path="url(#barClip)">
            <!-- Good zone -->
            <rect x="100" y="60" width="200" height="30" fill="#4ade8040"/>
            
            <!-- Moderate zone -->
            <rect x="300" y="60" width="200" height="30" fill="#fbbf2440"/>
            
            <!-- Bad zone -->
            <rect x="500" y="60" width="200" height="30" fill="#f8717140"/>
          </g>
          
          <!-- Labels on top -->
          <text x="200" y="80" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="500">Good</text>
          <text x="400" y="80" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="500">Moderate</text>
          <text x="600" y="80" text-anchor="middle" fill="#f87171" font-size="11" font-weight="500">Bad</text>
          
          <!-- Scale labels -->
          <text x="100" y="110" text-anchor="middle" fill="#8b90a0" font-size="10">0ms</text>
          <text x="300" y="110" text-anchor="middle" fill="#8b90a0" font-size="10">20ms</text>
          <text x="500" y="110" text-anchor="middle" fill="#8b90a0" font-size="10">50ms</text>
          <text x="700" y="110" text-anchor="middle" fill="#8b90a0" font-size="10">100ms+</text>
          
          <!-- Descriptions -->
          <text x="200" y="135" text-anchor="middle" fill="#4ade80" font-size="9">&lt; 20ms: Excellent</text>
          <text x="400" y="135" text-anchor="middle" fill="#fbbf24" font-size="9">20-50ms: Acceptable</text>
          <text x="600" y="135" text-anchor="middle" fill="#f87171" font-size="9">&gt; 50ms: Problematic</text>
        </svg>
      </div>

      <table>
        <thead>
          <tr>
            <th>Jitter</th>
            <th>Quality</th>
            <th>User Experience</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>&lt; 20ms</td>
            <td>Excellent</td>
            <td>Smooth audio, minimal buffering needed</td>
          </tr>
          <tr>
            <td>20-50ms</td>
            <td>Acceptable</td>
            <td>Small buffer handles it, occasional glitch</td>
          </tr>
          <tr>
            <td>50-100ms</td>
            <td>Poor</td>
            <td>Large buffer needed, noticeable delay</td>
          </tr>
          <tr>
            <td>&gt; 100ms</td>
            <td>Bad</td>
            <td>Audio breaks up, conversation difficult</td>
          </tr>
        </tbody>
      </table>

    </article>

    <footer class="doc-footer">
      <a href="index.html">&larr; Back to all docs</a>
    </footer>
  </div>

</body>
</html>
