<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PCM &amp; Audio Encoding &mdash; WebRTC Docs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/style.css">
  <style>
    .diagram {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin: 24px 0;
      overflow-x: auto;
    }
    .diagram svg {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }
    .diagram-caption {
      text-align: center;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 16px;
      font-style: italic;
    }
    .component-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin: 16px 0;
    }
    .component-card h4 {
      color: var(--accent);
      font-size: 1.1rem;
      margin-bottom: 8px;
    }
    .component-card p {
      margin: 0;
      color: var(--text-muted);
      font-size: 0.95rem;
    }
    .key-point {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      background: var(--accent-dim);
      border-radius: var(--radius);
      margin: 16px 0;
    }
    .key-point-icon {
      font-size: 1.2rem;
      line-height: 1;
    }
    .key-point p {
      margin: 0;
      color: var(--text);
    }
    .component-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
      margin: 24px 0;
    }
    .code-block {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin: 16px 0;
      overflow-x: auto;
    }
    .code-block pre {
      margin: 0;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.7;
    }
    .code-block .comment {
      color: #6a9955;
    }
    .code-block .keyword {
      color: #c586c0;
    }
    .code-block .string {
      color: #ce9178;
    }
    .code-block .number {
      color: #b5cea8;
    }
    .code-block .function {
      color: #dcdcaa;
    }
    .code-block .variable {
      color: #9cdcfe;
    }
    .code-block .type {
      color: #4ec9b0;
    }
    .hex-display {
      background: #1e1e1e;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin: 16px 0;
      font-family: var(--font-mono);
      font-size: 0.8rem;
      overflow-x: auto;
    }
    .hex-display .offset {
      color: #858585;
    }
    .hex-display .hex {
      color: #9cdcfe;
    }
    .hex-display .ascii {
      color: #ce9178;
    }
    .hex-display .header-bytes {
      color: #4ec9b0;
    }
    .hex-display .data-bytes {
      color: #6c9cfc;
    }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .comparison-table th {
      background: var(--surface);
      padding: 12px;
      text-align: left;
      border: 1px solid var(--border);
      color: var(--accent);
    }
    .comparison-table td {
      padding: 12px;
      border: 1px solid var(--border);
      color: var(--text-muted);
    }
    .codec-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin: 20px 0;
    }
    .codec-card h4 {
      color: var(--accent);
      font-size: 1.2rem;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .codec-card .badge {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 4px;
      background: var(--accent-dim);
      color: var(--accent);
    }
    .codec-card ul {
      margin: 12px 0 0 20px;
      color: var(--text-muted);
    }
    .codec-card li {
      margin-bottom: 6px;
    }
    .visual-sample {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin: 12px 0;
    }
    .sample-box {
      background: var(--surface-hover);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-family: var(--font-mono);
      font-size: 0.85rem;
    }
    .sample-box.positive {
      border-color: #4ade80;
      color: #4ade80;
    }
    .sample-box.negative {
      border-color: #f87171;
      color: #f87171;
    }
    .sample-box.zero {
      border-color: #fbbf24;
      color: #fbbf24;
    }
    .flow-arrow {
      color: var(--text-muted);
      font-size: 1.2rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <header class="doc-header">
      <a href="../index.html">&larr; Back to all docs</a>
      <h1>PCM &amp; Audio Encoding</h1>
      <p class="subtitle">Understanding raw audio, codecs, AudioContext, and the Audio element</p>
    </header>

    <article class="doc-content">

      <!-- ============================================ -->
      <!-- SECTION: What is PCM? -->
      <!-- ============================================ -->
      <h2>What is PCM?</h2>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>PCM = Pulse Code Modulation</strong> &mdash; The most basic digital audio format. It's just numbers representing the sound wave's amplitude at each moment in time.</p>
      </div>

      <p>Sound is a continuous wave of air pressure changes. To store it digitally, we:</p>
      <ol>
        <li><strong>Sample</strong> the wave at regular intervals (e.g., 48,000 times per second)</li>
        <li><strong>Quantize</strong> each sample to a number (e.g., 16-bit = -32,768 to +32,767)</li>
      </ol>

      <div class="diagram">
        <svg viewBox="0 0 900 320" xmlns="http://www.w3.org/2000/svg">
          <text x="450" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">PCM: Analog Wave → Digital Numbers</text>
          
          <!-- Analog wave section -->
          <text x="200" y="60" text-anchor="middle" fill="#8b90a0" font-size="11">1. Analog Sound Wave (continuous)</text>
          
          <!-- Smooth sine wave -->
          <path d="M30 150 Q80 80 130 150 Q180 220 230 150 Q280 80 330 150 Q380 220 430 150" 
                fill="none" stroke="#6c9cfc" stroke-width="3"/>
          
          <!-- Zero line -->
          <line x1="30" y1="150" x2="430" y2="150" stroke="#3a3f50" stroke-width="1" stroke-dasharray="5,5"/>
          <text x="20" y="154" fill="#8b90a0" font-size="9">0</text>
          
          <!-- Sampling points with values -->
          <g>
            <!-- Sample 0 -->
            <circle cx="30" cy="150" r="6" fill="#4ade80"/>
            <line x1="30" y1="150" x2="30" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="30" y="215" text-anchor="middle" fill="#4ade80" font-size="8">0</text>
            
            <!-- Sample 1 -->
            <circle cx="80" cy="100" r="6" fill="#4ade80"/>
            <line x1="80" y1="100" x2="80" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="80" y="215" text-anchor="middle" fill="#4ade80" font-size="8">+23170</text>
            
            <!-- Sample 2 -->
            <circle cx="130" cy="150" r="6" fill="#4ade80"/>
            <line x1="130" y1="150" x2="130" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="130" y="215" text-anchor="middle" fill="#4ade80" font-size="8">0</text>
            
            <!-- Sample 3 -->
            <circle cx="180" cy="200" r="6" fill="#4ade80"/>
            <line x1="180" y1="200" x2="180" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="180" y="215" text-anchor="middle" fill="#4ade80" font-size="8">-23170</text>
            
            <!-- Sample 4 -->
            <circle cx="230" cy="150" r="6" fill="#4ade80"/>
            <line x1="230" y1="150" x2="230" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="230" y="215" text-anchor="middle" fill="#4ade80" font-size="8">0</text>
            
            <!-- Sample 5 -->
            <circle cx="280" cy="100" r="6" fill="#4ade80"/>
            <line x1="280" y1="100" x2="280" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="280" y="215" text-anchor="middle" fill="#4ade80" font-size="8">+23170</text>
            
            <!-- Sample 6 -->
            <circle cx="330" cy="150" r="6" fill="#4ade80"/>
            <line x1="330" y1="150" x2="330" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="330" y="215" text-anchor="middle" fill="#4ade80" font-size="8">0</text>
            
            <!-- Sample 7 -->
            <circle cx="380" cy="200" r="6" fill="#4ade80"/>
            <line x1="380" y1="200" x2="380" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="380" y="215" text-anchor="middle" fill="#4ade80" font-size="8">-23170</text>
            
            <!-- Sample 8 -->
            <circle cx="430" cy="150" r="6" fill="#4ade80"/>
            <line x1="430" y1="150" x2="430" y2="200" stroke="#4ade80" stroke-width="1" stroke-dasharray="3,2"/>
            <text x="430" y="215" text-anchor="middle" fill="#4ade80" font-size="8">0</text>
          </g>
          
          <text x="230" y="240" text-anchor="middle" fill="#4ade80" font-size="10">Sample points (green dots)</text>
          
          <!-- Arrow -->
          <path d="M460 150 L510 150" stroke="#fbbf24" stroke-width="3" marker-end="url(#arr-pcm)"/>
          <text x="485" y="140" text-anchor="middle" fill="#fbbf24" font-size="9">Sample</text>
          
          <!-- PCM Array representation -->
          <text x="700" y="60" text-anchor="middle" fill="#8b90a0" font-size="11">2. PCM Data (array of numbers)</text>
          
          <rect x="540" y="80" width="320" height="180" rx="8" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          
          <text x="560" y="110" fill="#c586c0" font-family="monospace" font-size="11">const</text>
          <text x="600" y="110" fill="#9cdcfe" font-family="monospace" font-size="11">pcmSamples</text>
          <text x="705" y="110" fill="#e1e4ed" font-family="monospace" font-size="11">=</text>
          <text x="720" y="110" fill="#fbbf24" font-family="monospace" font-size="11">[</text>
          
          <text x="580" y="135" fill="#6c9cfc" font-family="monospace" font-size="10">[0]</text>
          <text x="650" y="135" fill="#b5cea8" font-family="monospace" font-size="11">0,</text>
          <text x="720" y="135" fill="#6a9955" font-family="monospace" font-size="10">// silence</text>
          
          <text x="580" y="155" fill="#6c9cfc" font-family="monospace" font-size="10">[1]</text>
          <text x="650" y="155" fill="#4ade80" font-family="monospace" font-size="11">23170,</text>
          <text x="720" y="155" fill="#6a9955" font-family="monospace" font-size="10">// peak up</text>
          
          <text x="580" y="175" fill="#6c9cfc" font-family="monospace" font-size="10">[2]</text>
          <text x="650" y="175" fill="#b5cea8" font-family="monospace" font-size="11">0,</text>
          <text x="720" y="175" fill="#6a9955" font-family="monospace" font-size="10">// crossing</text>
          
          <text x="580" y="195" fill="#6c9cfc" font-family="monospace" font-size="10">[3]</text>
          <text x="650" y="195" fill="#f87171" font-family="monospace" font-size="11">-23170,</text>
          <text x="720" y="195" fill="#6a9955" font-family="monospace" font-size="10">// peak down</text>
          
          <text x="580" y="215" fill="#6c9cfc" font-family="monospace" font-size="10">[4]</text>
          <text x="650" y="215" fill="#b5cea8" font-family="monospace" font-size="11">0,</text>
          <text x="720" y="215" fill="#6a9955" font-family="monospace" font-size="10">// crossing</text>
          
          <text x="580" y="235" fill="#8b90a0" font-family="monospace" font-size="10">...</text>
          <text x="650" y="235" fill="#8b90a0" font-family="monospace" font-size="10">// 48,000 samples/sec</text>
          
          <text x="720" y="250" fill="#fbbf24" font-family="monospace" font-size="11">];</text>
          
          <!-- Explanation box -->
          <rect x="100" y="270" width="700" height="40" rx="6" fill="#242836"/>
          <text x="450" y="295" text-anchor="middle" fill="#8b90a0" font-size="11">16-bit PCM: Each sample is an integer from -32,768 to +32,767 (representing air pressure)</text>
          
          <defs>
            <marker id="arr-pcm" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#fbbf24"/>
            </marker>
          </defs>
        </svg>
        <p class="diagram-caption">PCM captures the wave's height at regular intervals as numbers</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: What PCM Looks Like -->
      <!-- ============================================ -->
      <h2>What Does PCM Data Actually Look Like?</h2>

      <p>Here's a real example of PCM data for a simple 440Hz sine wave (musical note A):</p>

      <div class="code-block">
        <pre><span class="comment">// PCM samples for 440Hz sine wave at 48kHz sample rate</span>
<span class="comment">// Each number = amplitude at that moment (-32768 to +32767 for 16-bit)</span>

<span class="keyword">const</span> <span class="variable">pcmData</span> = <span class="type">Int16Array</span>([
    <span class="number">0</span>,       <span class="comment">// t=0.000ms    - wave at zero</span>
    <span class="number">1876</span>,    <span class="comment">// t=0.021ms    - rising</span>
    <span class="number">3720</span>,    <span class="comment">// t=0.042ms    - rising</span>
    <span class="number">5501</span>,    <span class="comment">// t=0.063ms    - rising</span>
    <span class="number">7189</span>,    <span class="comment">// t=0.083ms    - rising</span>
    <span class="comment">// ... continues ...</span>
    <span class="number">23170</span>,   <span class="comment">// t=0.568ms    - PEAK (maximum)</span>
    <span class="comment">// ... continues ...</span>
    <span class="number">0</span>,       <span class="comment">// t=1.136ms    - back to zero</span>
    <span class="number">-1876</span>,   <span class="comment">// t=1.157ms    - going negative</span>
    <span class="comment">// ... continues ...</span>
    <span class="number">-23170</span>,  <span class="comment">// t=1.705ms    - TROUGH (minimum)</span>
    <span class="comment">// ... continues ...</span>
    <span class="number">0</span>,       <span class="comment">// t=2.273ms    - one complete cycle!</span>
]);</pre>
      </div>

      <h3>Visual Representation of PCM Samples</h3>
      
      <div class="visual-sample">
        <div class="sample-box zero">0</div>
        <span class="flow-arrow">→</span>
        <div class="sample-box positive">+1876</div>
        <span class="flow-arrow">→</span>
        <div class="sample-box positive">+3720</div>
        <span class="flow-arrow">→</span>
        <div class="sample-box positive">+23170</div>
        <span class="flow-arrow">→</span>
        <div class="sample-box zero">0</div>
        <span class="flow-arrow">→</span>
        <div class="sample-box negative">-23170</div>
        <span class="flow-arrow">→</span>
        <div class="sample-box zero">0</div>
      </div>

      <p>This is one cycle of a sine wave. For 1 second of audio at 48kHz, you'd have <strong>48,000 of these numbers</strong>!</p>

      <h3>Raw Bytes in Memory</h3>

      <p>In memory, 16-bit PCM looks like this (little-endian byte order):</p>

      <div class="hex-display">
<span class="offset">Offset    </span><span class="hex">Hex bytes                                      </span><span class="ascii">Decoded values</span>
<span class="offset">0x0000    </span><span class="data-bytes">00 00</span> <span class="data-bytes">54 07</span> <span class="data-bytes">88 0E</span> <span class="data-bytes">7D 15</span> <span class="data-bytes">15 1C</span>    <span class="ascii">0, 1876, 3720, 5501, 7189</span>
<span class="offset">0x000A    </span><span class="data-bytes">32 5A</span> <span class="data-bytes">00 00</span> <span class="data-bytes">AC F8</span> <span class="data-bytes">CE A5</span>          <span class="ascii">23090, 0, -1876, -23090</span>
      </div>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>PCM is just numbers!</strong> No headers, no compression, no metadata. Just raw amplitude values in sequence.</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: PCM Formats -->
      <!-- ============================================ -->
      <h2>PCM Formats (Bit Depth &amp; Types)</h2>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>PCM comes in different "flavors"</strong> &mdash; They differ in bit depth (precision) and number representation (integer vs float).</p>
      </div>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>Format</th>
            <th>Range</th>
            <th>Size</th>
            <th>Use Case</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Int8 (8-bit signed)</strong></td>
            <td>-128 to +127</td>
            <td>1 byte</td>
            <td>Old games, low-quality</td>
          </tr>
          <tr>
            <td><strong>Uint8 (8-bit unsigned)</strong></td>
            <td>0 to 255</td>
            <td>1 byte</td>
            <td>WAV files (8-bit)</td>
          </tr>
          <tr>
            <td><strong>Int16 (16-bit)</strong></td>
            <td>-32,768 to +32,767</td>
            <td>2 bytes</td>
            <td>CD quality, most common</td>
          </tr>
          <tr>
            <td><strong>Int24 (24-bit)</strong></td>
            <td>-8,388,608 to +8,388,607</td>
            <td>3 bytes</td>
            <td>Professional audio</td>
          </tr>
          <tr>
            <td><strong>Int32 (32-bit)</strong></td>
            <td>-2.1B to +2.1B</td>
            <td>4 bytes</td>
            <td>Studio recording</td>
          </tr>
          <tr>
            <td><strong>Float32 (32-bit float)</strong></td>
            <td>-1.0 to +1.0</td>
            <td>4 bytes</td>
            <td>AudioContext, DAWs</td>
          </tr>
          <tr>
            <td><strong>Float64 (64-bit float)</strong></td>
            <td>-1.0 to +1.0</td>
            <td>8 bytes</td>
            <td>High-precision DSP</td>
          </tr>
        </tbody>
      </table>

      <h3>Visual: Same Wave, Different Formats</h3>

      <div class="diagram">
        <svg viewBox="0 0 900 380" xmlns="http://www.w3.org/2000/svg">
          <text x="450" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">Same Peak Amplitude in Different PCM Formats</text>
          
          <!-- Sine wave reference -->
          <path d="M50 80 Q100 50 150 80 Q200 110 250 80" fill="none" stroke="#6c9cfc" stroke-width="2"/>
          <text x="150" y="130" text-anchor="middle" fill="#8b90a0" font-size="10">Original wave peak</text>
          
          <!-- Arrow -->
          <path d="M280 80 L320 80" stroke="#fbbf24" stroke-width="2" marker-end="url(#arr-fmt)"/>
          
          <!-- Format boxes -->
          <rect x="340" y="40" width="520" height="320" rx="12" fill="#1a1d27" stroke="#4ade80" stroke-width="2"/>
          <text x="600" y="70" text-anchor="middle" fill="#4ade80" font-size="12" font-weight="500">Peak Value in Each Format</text>
          
          <!-- Int8 -->
          <rect x="370" y="90" width="220" height="40" rx="6" fill="#242836" stroke="#f87171" stroke-width="1"/>
          <text x="390" y="115" fill="#f87171" font-size="11" font-weight="500">Int8:</text>
          <text x="480" y="115" fill="#e1e4ed" font-family="monospace" font-size="12">127</text>
          <text x="560" y="115" fill="#8b90a0" font-size="9">(max for 8-bit)</text>
          
          <!-- Uint8 -->
          <rect x="610" y="90" width="220" height="40" rx="6" fill="#242836" stroke="#fbbf24" stroke-width="1"/>
          <text x="630" y="115" fill="#fbbf24" font-size="11" font-weight="500">Uint8:</text>
          <text x="720" y="115" fill="#e1e4ed" font-family="monospace" font-size="12">255</text>
          <text x="790" y="115" fill="#8b90a0" font-size="9">(0 = silence)</text>
          
          <!-- Int16 -->
          <rect x="370" y="145" width="220" height="40" rx="6" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="390" y="170" fill="#4ade80" font-size="11" font-weight="500">Int16:</text>
          <text x="480" y="170" fill="#e1e4ed" font-family="monospace" font-size="12">32,767</text>
          <text x="560" y="170" fill="#4ade80" font-size="9">← CD Quality</text>
          
          <!-- Int24 -->
          <rect x="610" y="145" width="220" height="40" rx="6" fill="#242836" stroke="#c586c0" stroke-width="1"/>
          <text x="630" y="170" fill="#c586c0" font-size="11" font-weight="500">Int24:</text>
          <text x="720" y="170" fill="#e1e4ed" font-family="monospace" font-size="12">8,388,607</text>
          <text x="810" y="170" fill="#8b90a0" font-size="9">Pro</text>
          
          <!-- Int32 -->
          <rect x="370" y="200" width="220" height="40" rx="6" fill="#242836" stroke="#9cdcfe" stroke-width="1"/>
          <text x="390" y="225" fill="#9cdcfe" font-size="11" font-weight="500">Int32:</text>
          <text x="480" y="225" fill="#e1e4ed" font-family="monospace" font-size="12">2,147,483,647</text>
          
          <!-- Float32 -->
          <rect x="610" y="200" width="220" height="40" rx="6" fill="#242836" stroke="#6c9cfc" stroke-width="2"/>
          <text x="630" y="225" fill="#6c9cfc" font-size="11" font-weight="500">Float32:</text>
          <text x="720" y="225" fill="#e1e4ed" font-family="monospace" font-size="12">1.0</text>
          <text x="770" y="225" fill="#6c9cfc" font-size="9">← AudioContext</text>
          
          <!-- Float64 -->
          <rect x="370" y="255" width="220" height="40" rx="6" fill="#242836" stroke="#8b90a0" stroke-width="1"/>
          <text x="390" y="280" fill="#8b90a0" font-size="11" font-weight="500">Float64:</text>
          <text x="480" y="280" fill="#e1e4ed" font-family="monospace" font-size="12">1.0</text>
          <text x="540" y="280" fill="#8b90a0" font-size="9">(more precision)</text>
          
          <!-- Key insight box -->
          <rect x="370" y="310" width="460" height="40" rx="6" fill="#242836"/>
          <text x="600" y="335" text-anchor="middle" fill="#8b90a0" font-size="10">All represent the SAME sound - just different number systems!</text>
          
          <defs>
            <marker id="arr-fmt" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#fbbf24"/>
            </marker>
          </defs>
        </svg>
        <p class="diagram-caption">The same audio peak represented in different PCM formats</p>
      </div>

      <h3>Why Float32 in AudioContext?</h3>

      <div class="code-block">
        <pre><span class="comment">// AudioContext ALWAYS uses Float32Array internally</span>
<span class="keyword">const</span> <span class="variable">audioCtx</span> = <span class="keyword">new</span> <span class="type">AudioContext</span>();
<span class="keyword">const</span> <span class="variable">buffer</span> = <span class="variable">audioCtx</span>.<span class="function">createBuffer</span>(<span class="number">1</span>, <span class="number">48000</span>, <span class="number">48000</span>);
<span class="keyword">const</span> <span class="variable">pcm</span> = <span class="variable">buffer</span>.<span class="function">getChannelData</span>(<span class="number">0</span>); <span class="comment">// Returns Float32Array!</span>

<span class="comment">// Values are normalized: -1.0 to +1.0</span>
<span class="variable">pcm</span>[<span class="number">0</span>] = <span class="number">0.0</span>;      <span class="comment">// silence (center)</span>
<span class="variable">pcm</span>[<span class="number">1</span>] = <span class="number">0.707</span>;    <span class="comment">// ~70% amplitude</span>
<span class="variable">pcm</span>[<span class="number">2</span>] = <span class="number">1.0</span>;      <span class="comment">// maximum (clipping if exceeded!)</span>
<span class="variable">pcm</span>[<span class="number">3</span>] = <span class="number">-0.5</span>;     <span class="comment">// negative half amplitude</span>
<span class="variable">pcm</span>[<span class="number">4</span>] = <span class="number">-1.0</span>;     <span class="comment">// minimum</span></pre>
      </div>

      <div class="component-grid">
        <div class="component-card">
          <h4>Why Floats for Processing?</h4>
          <p><strong>No overflow worries</strong> &mdash; Intermediate calculations can exceed 1.0 temporarily without wrapping around. Final output is clipped.</p>
        </div>
        <div class="component-card">
          <h4>Easy Mixing</h4>
          <p><strong>Just add values</strong> &mdash; Mix two sounds: <code>output = sound1 + sound2</code>. With integers, you'd need to handle overflow.</p>
        </div>
        <div class="component-card">
          <h4>Format Agnostic</h4>
          <p><strong>Universal scale</strong> &mdash; Whether source was 8-bit or 24-bit, it's all -1.0 to +1.0 in AudioContext.</p>
        </div>
        <div class="component-card">
          <h4>Precision</h4>
          <p><strong>~24-bit equivalent</strong> &mdash; Float32 mantissa gives ~7 decimal digits, similar to 24-bit integer precision.</p>
        </div>
      </div>

      <h3>Converting Between Formats</h3>

      <div class="code-block">
        <pre><span class="comment">// Int16 ↔ Float32 conversion (what AudioContext does internally)</span>

<span class="comment">// Int16 → Float32</span>
<span class="keyword">function</span> <span class="function">int16ToFloat32</span>(<span class="variable">int16Value</span>) {
  <span class="keyword">return</span> <span class="variable">int16Value</span> / <span class="number">32768.0</span>;
}

<span class="comment">// Float32 → Int16</span>
<span class="keyword">function</span> <span class="function">float32ToInt16</span>(<span class="variable">floatValue</span>) {
  <span class="keyword">return</span> <span class="type">Math</span>.<span class="function">round</span>(<span class="variable">floatValue</span> * <span class="number">32767</span>);
}

<span class="comment">// Examples:</span>
<span class="function">int16ToFloat32</span>(<span class="number">0</span>);       <span class="comment">// → 0.0      (silence)</span>
<span class="function">int16ToFloat32</span>(<span class="number">16384</span>);   <span class="comment">// → 0.5      (half amplitude)</span>
<span class="function">int16ToFloat32</span>(<span class="number">32767</span>);   <span class="comment">// → ~1.0     (max positive)</span>
<span class="function">int16ToFloat32</span>(<span class="number">-32768</span>);  <span class="comment">// → -1.0     (max negative)</span>

<span class="function">float32ToInt16</span>(<span class="number">0.0</span>);     <span class="comment">// → 0</span>
<span class="function">float32ToInt16</span>(<span class="number">0.5</span>);     <span class="comment">// → 16384</span>
<span class="function">float32ToInt16</span>(<span class="number">1.0</span>);     <span class="comment">// → 32767</span>
<span class="function">float32ToInt16</span>(<span class="number">-1.0</span>);    <span class="comment">// → -32767</span></pre>
      </div>

      <h3>Where Each Format is Used</h3>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>Format</th>
            <th>Where You'll See It</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Int16</strong></td>
            <td>WAV files, CD audio, WebRTC internal processing, most audio hardware</td>
          </tr>
          <tr>
            <td><strong>Float32</strong></td>
            <td>Web Audio API (AudioContext), DAWs, audio plugins, real-time processing</td>
          </tr>
          <tr>
            <td><strong>Int24</strong></td>
            <td>Professional recording, high-end audio interfaces, studio masters</td>
          </tr>
          <tr>
            <td><strong>Uint8</strong></td>
            <td>Old WAV files, retro games, very low-quality audio</td>
          </tr>
          <tr>
            <td><strong>Float64</strong></td>
            <td>Scientific audio analysis, high-precision DSP algorithms</td>
          </tr>
        </tbody>
      </table>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>Web Audio API standardized on Float32</strong> &mdash; You don't need to worry about the source format. AudioContext converts everything to Float32 internally, making audio processing much simpler.</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: PCM vs WAV -->
      <!-- ============================================ -->
      <h2>PCM vs WAV File</h2>

      <p>WAV is a <strong>container format</strong> that wraps PCM data with a header describing the audio:</p>

      <div class="diagram">
        <svg viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg">
          <text x="400" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">WAV File = Header + PCM Data</text>
          
          <!-- WAV file container -->
          <rect x="50" y="50" width="700" height="220" rx="12" fill="none" stroke="#6c9cfc" stroke-width="2"/>
          <text x="400" y="75" text-anchor="middle" fill="#6c9cfc" font-size="12" font-weight="500">.WAV File</text>
          
          <!-- Header section -->
          <rect x="70" y="95" width="200" height="150" rx="8" fill="#242836" stroke="#fbbf24" stroke-width="2"/>
          <text x="170" y="120" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="500">WAV Header (44 bytes)</text>
          
          <text x="90" y="145" fill="#8b90a0" font-size="9">RIFF chunk ID</text>
          <text x="90" y="162" fill="#8b90a0" font-size="9">File size</text>
          <text x="90" y="179" fill="#8b90a0" font-size="9">Format: "WAVE"</text>
          <text x="90" y="196" fill="#8b90a0" font-size="9">Sample rate: 48000</text>
          <text x="90" y="213" fill="#8b90a0" font-size="9">Bits per sample: 16</text>
          <text x="90" y="230" fill="#8b90a0" font-size="9">Channels: 1 (mono)</text>
          
          <!-- PCM data section -->
          <rect x="290" y="95" width="440" height="150" rx="8" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="510" y="120" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="500">PCM Data (the actual audio)</text>
          
          <text x="310" y="150" fill="#4ade80" font-family="monospace" font-size="10">00 00 54 07 88 0E 7D 15 15 1C 32 5A ...</text>
          <text x="310" y="175" fill="#4ade80" font-family="monospace" font-size="10">CE A5 00 00 54 07 88 0E 7D 15 15 1C ...</text>
          <text x="310" y="200" fill="#4ade80" font-family="monospace" font-size="10">32 5A CE A5 00 00 54 07 88 0E 7D 15 ...</text>
          <text x="310" y="225" fill="#8b90a0" font-size="9">... (thousands more bytes of raw samples)</text>
          
          <!-- Arrow showing relationship -->
          <path d="M400 280 L400 270" stroke="#8b90a0" stroke-width="2"/>
          <text x="400" y="295" text-anchor="middle" fill="#8b90a0" font-size="10">WAV = "Here's how to read this PCM" + the PCM itself</text>
        </svg>
        <p class="diagram-caption">WAV wraps PCM with metadata so players know how to interpret it</p>
      </div>

      <div class="hex-display">
<span class="offset">WAV Header (first 44 bytes):</span>

<span class="offset">0x0000    </span><span class="header-bytes">52 49 46 46</span>    <span class="ascii">"RIFF" - file type marker</span>
<span class="offset">0x0004    </span><span class="header-bytes">24 08 00 00</span>    <span class="ascii">File size (2084 bytes)</span>
<span class="offset">0x0008    </span><span class="header-bytes">57 41 56 45</span>    <span class="ascii">"WAVE" - format</span>
<span class="offset">0x000C    </span><span class="header-bytes">66 6D 74 20</span>    <span class="ascii">"fmt " - format chunk</span>
<span class="offset">0x0010    </span><span class="header-bytes">10 00 00 00</span>    <span class="ascii">Chunk size (16)</span>
<span class="offset">0x0014    </span><span class="header-bytes">01 00</span>          <span class="ascii">Audio format (1 = PCM)</span>
<span class="offset">0x0016    </span><span class="header-bytes">01 00</span>          <span class="ascii">Channels (1 = mono)</span>
<span class="offset">0x0018    </span><span class="header-bytes">80 BB 00 00</span>    <span class="ascii">Sample rate (48000)</span>
<span class="offset">0x001C    </span><span class="header-bytes">00 77 01 00</span>    <span class="ascii">Byte rate (96000)</span>
<span class="offset">0x0020    </span><span class="header-bytes">02 00</span>          <span class="ascii">Block align (2)</span>
<span class="offset">0x0022    </span><span class="header-bytes">10 00</span>          <span class="ascii">Bits per sample (16)</span>
<span class="offset">0x0024    </span><span class="header-bytes">64 61 74 61</span>    <span class="ascii">"data" - data chunk marker</span>
<span class="offset">0x0028    </span><span class="header-bytes">00 08 00 00</span>    <span class="ascii">Data size (2048 bytes)</span>
<span class="offset">0x002C    </span><span class="data-bytes">00 00 54 07...</span> <span class="ascii">← PCM data starts here!</span>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Audio Codecs -->
      <!-- ============================================ -->
      <h2>Audio Codecs: Why Compress?</h2>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>Problem:</strong> Raw PCM is HUGE. 1 minute of 48kHz stereo 16-bit audio = 11.5 MB. That's way too much for real-time communication!</p>
      </div>

      <p>Codecs <strong>compress</strong> audio to reduce bandwidth while maintaining quality. Here's how different codecs compare:</p>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>Codec</th>
            <th>Bitrate</th>
            <th>Compression</th>
            <th>Use Case</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>PCM (raw)</strong></td>
            <td>768 kbps</td>
            <td>None (1x)</td>
            <td>Editing, processing</td>
          </tr>
          <tr>
            <td><strong>PCMU (G.711 μ-law)</strong></td>
            <td>64 kbps</td>
            <td>12x</td>
            <td>Telephony (PSTN)</td>
          </tr>
          <tr>
            <td><strong>PCMA (G.711 A-law)</strong></td>
            <td>64 kbps</td>
            <td>12x</td>
            <td>Telephony (Europe)</td>
          </tr>
          <tr>
            <td><strong>Opus</strong></td>
            <td>6-510 kbps</td>
            <td>24-128x</td>
            <td>WebRTC (default)</td>
          </tr>
          <tr>
            <td><strong>AAC</strong></td>
            <td>64-320 kbps</td>
            <td>2-12x</td>
            <td>Streaming, music</td>
          </tr>
          <tr>
            <td><strong>MP3</strong></td>
            <td>128-320 kbps</td>
            <td>2-6x</td>
            <td>Music files</td>
          </tr>
        </tbody>
      </table>

      <!-- ============================================ -->
      <!-- SECTION: Codec Deep Dive -->
      <!-- ============================================ -->
      <h2>Codec Deep Dive</h2>

      <div class="codec-card">
        <h4>Opus <span class="badge">WebRTC Default</span></h4>
        <p>The Swiss Army knife of audio codecs. Designed specifically for real-time communication.</p>
        <ul>
          <li><strong>Bitrate:</strong> 6 kbps (voice) to 510 kbps (music)</li>
          <li><strong>Latency:</strong> As low as 2.5ms</li>
          <li><strong>Adaptive:</strong> Adjusts quality based on network conditions</li>
          <li><strong>Hybrid:</strong> Uses SILK (voice) + CELT (music) internally</li>
        </ul>
        
        <div class="code-block">
          <pre><span class="comment">// What Opus does to your audio:</span>

<span class="comment">// Input: 960 PCM samples (20ms at 48kHz)</span>
<span class="variable">pcmInput</span> = [<span class="number">0</span>, <span class="number">1876</span>, <span class="number">3720</span>, ... <span class="number">960</span> samples ...] <span class="comment">// 1920 bytes</span>

<span class="comment">// Output: Opus frame</span>
<span class="variable">opusFrame</span> = [<span class="number">0x48</span>, <span class="number">0xc0</span>, <span class="number">0x1a</span>, ... ~<span class="number">40</span> bytes ...] <span class="comment">// ~40 bytes!</span>

<span class="comment">// Compression ratio: 1920 / 40 = 48x smaller!</span></pre>
        </div>
      </div>

      <div class="codec-card">
        <h4>PCMU (G.711 μ-law) <span class="badge">Telephony</span></h4>
        <p>The original digital telephony codec from 1972. Still used for compatibility.</p>
        <ul>
          <li><strong>Bitrate:</strong> Fixed 64 kbps</li>
          <li><strong>Sample rate:</strong> 8 kHz only (telephone quality)</li>
          <li><strong>Compression:</strong> Logarithmic companding (not psychoacoustic)</li>
          <li><strong>Why "μ-law":</strong> Uses μ (mu) companding curve, optimized for North America/Japan</li>
        </ul>
        
        <div class="code-block">
          <pre><span class="comment">// PCMU companding: 16-bit → 8-bit using logarithmic curve</span>

<span class="comment">// Input: 16-bit PCM sample</span>
<span class="variable">pcmSample</span> = <span class="number">23170</span>;  <span class="comment">// 16-bit value</span>

<span class="comment">// μ-law formula: F(x) = sgn(x) * ln(1 + μ|x|) / ln(1 + μ)</span>
<span class="comment">// where μ = 255 for North American telephony</span>

<span class="comment">// Output: 8-bit compressed value</span>
<span class="variable">muLawSample</span> = <span class="number">0x84</span>;  <span class="comment">// 8-bit value (132)</span>

<span class="comment">// Key insight: Preserves more detail in quiet sounds</span>
<span class="comment">// (human hearing is logarithmic, not linear)</span></pre>
        </div>
      </div>

      <div class="codec-card">
        <h4>PCMA (G.711 A-law) <span class="badge">Telephony EU</span></h4>
        <p>European variant of G.711. Same concept, different companding curve.</p>
        <ul>
          <li><strong>Bitrate:</strong> Fixed 64 kbps</li>
          <li><strong>Difference:</strong> Slightly different logarithmic curve than μ-law</li>
          <li><strong>Used in:</strong> Europe, Africa, Asia (except Japan)</li>
          <li><strong>Quality:</strong> Slightly better for small signals than μ-law</li>
        </ul>
      </div>

      <h3>What Encoded Data Looks Like</h3>

      <div class="diagram">
        <svg viewBox="0 0 900 350" xmlns="http://www.w3.org/2000/svg">
          <text x="450" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">Same Audio, Different Encodings</text>
          
          <!-- PCM -->
          <rect x="30" y="50" width="260" height="130" rx="8" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="160" y="75" text-anchor="middle" fill="#4ade80" font-size="11" font-weight="500">PCM (Raw) - 20ms</text>
          <text x="50" y="100" fill="#8b90a0" font-family="monospace" font-size="9">00 00 54 07 88 0E 7D 15</text>
          <text x="50" y="115" fill="#8b90a0" font-family="monospace" font-size="9">15 1C 32 22 B8 27 8E 2C</text>
          <text x="50" y="130" fill="#8b90a0" font-family="monospace" font-size="9">... (1920 bytes total)</text>
          <text x="160" y="160" text-anchor="middle" fill="#f87171" font-size="10" font-weight="500">1920 bytes</text>
          
          <!-- PCMU -->
          <rect x="320" y="50" width="260" height="130" rx="8" fill="#242836" stroke="#fbbf24" stroke-width="2"/>
          <text x="450" y="75" text-anchor="middle" fill="#fbbf24" font-size="11" font-weight="500">PCMU (G.711) - 20ms</text>
          <text x="340" y="100" fill="#8b90a0" font-family="monospace" font-size="9">FF 84 80 7C 78 74 70 6C</text>
          <text x="340" y="115" fill="#8b90a0" font-family="monospace" font-size="9">68 64 60 5C 58 54 50 4C</text>
          <text x="340" y="130" fill="#8b90a0" font-family="monospace" font-size="9">... (160 bytes total)</text>
          <text x="450" y="160" text-anchor="middle" fill="#4ade80" font-size="10" font-weight="500">160 bytes (12x smaller)</text>
          
          <!-- Opus -->
          <rect x="610" y="50" width="260" height="130" rx="8" fill="#242836" stroke="#6c9cfc" stroke-width="2"/>
          <text x="740" y="75" text-anchor="middle" fill="#6c9cfc" font-size="11" font-weight="500">Opus - 20ms</text>
          <text x="630" y="100" fill="#8b90a0" font-family="monospace" font-size="9">48 C0 1A 3B 7E 92 F1 D4</text>
          <text x="630" y="115" fill="#8b90a0" font-family="monospace" font-size="9">A8 6C 2E 55 B9 03 C7 8F</text>
          <text x="630" y="130" fill="#8b90a0" font-family="monospace" font-size="9">... (~40 bytes total)</text>
          <text x="740" y="160" text-anchor="middle" fill="#4ade80" font-size="10" font-weight="500">~40 bytes (48x smaller!)</text>
          
          <!-- Comparison bars -->
          <text x="450" y="210" text-anchor="middle" fill="#8b90a0" font-size="11">Size comparison for 20ms of audio:</text>
          
          <!-- PCM bar -->
          <rect x="100" y="230" width="700" height="20" rx="4" fill="#4ade80" opacity="0.3"/>
          <rect x="100" y="230" width="700" height="20" rx="4" fill="#4ade80"/>
          <text x="450" y="245" text-anchor="middle" fill="#0f1117" font-size="10" font-weight="600">PCM: 1920 bytes</text>
          
          <!-- PCMU bar -->
          <rect x="100" y="260" width="58" height="20" rx="4" fill="#fbbf24"/>
          <text x="170" y="275" fill="#fbbf24" font-size="10">PCMU: 160 bytes</text>
          
          <!-- Opus bar -->
          <rect x="100" y="290" width="15" height="20" rx="4" fill="#6c9cfc"/>
          <text x="130" y="305" fill="#6c9cfc" font-size="10">Opus: ~40 bytes</text>
          
          <text x="450" y="340" text-anchor="middle" fill="#8b90a0" font-size="10">Opus achieves 48x compression while maintaining excellent quality!</text>
        </svg>
        <p class="diagram-caption">The same 20ms of audio encoded three different ways</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: AudioContext -->
      <!-- ============================================ -->
      <h2>What Does AudioContext Read?</h2>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>AudioContext works with PCM only!</strong> It's a low-level API that processes raw audio samples as floating-point numbers (-1.0 to +1.0).</p>
      </div>

      <div class="diagram">
        <svg viewBox="0 0 900 400" xmlns="http://www.w3.org/2000/svg">
          <text x="450" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">AudioContext: The Audio Processing Engine</text>
          
          <!-- Input sources -->
          <text x="100" y="60" text-anchor="middle" fill="#8b90a0" font-size="11">Input Sources</text>
          
          <rect x="30" y="75" width="140" height="50" rx="6" fill="#242836" stroke="#f87171" stroke-width="2"/>
          <text x="100" y="105" text-anchor="middle" fill="#f87171" font-size="10">Microphone</text>
          
          <rect x="30" y="135" width="140" height="50" rx="6" fill="#242836" stroke="#fbbf24" stroke-width="2"/>
          <text x="100" y="165" text-anchor="middle" fill="#fbbf24" font-size="10">MediaStream</text>
          
          <rect x="30" y="195" width="140" height="50" rx="6" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="100" y="225" text-anchor="middle" fill="#4ade80" font-size="10">AudioBuffer</text>
          
          <rect x="30" y="255" width="140" height="50" rx="6" fill="#242836" stroke="#6c9cfc" stroke-width="2"/>
          <text x="100" y="285" text-anchor="middle" fill="#6c9cfc" font-size="10">Oscillator</text>
          
          <!-- Arrows to AudioContext -->
          <path d="M170 100 L220 180" stroke="#8b90a0" stroke-width="1.5"/>
          <path d="M170 160 L220 180" stroke="#8b90a0" stroke-width="1.5"/>
          <path d="M170 220 L220 200" stroke="#8b90a0" stroke-width="1.5"/>
          <path d="M170 280 L220 220" stroke="#8b90a0" stroke-width="1.5"/>
          
          <!-- AudioContext box -->
          <rect x="230" y="80" width="440" height="240" rx="12" fill="#1a1d27" stroke="#6c9cfc" stroke-width="3"/>
          <text x="450" y="110" text-anchor="middle" fill="#6c9cfc" font-size="14" font-weight="600">AudioContext</text>
          <text x="450" y="130" text-anchor="middle" fill="#8b90a0" font-size="10">Works with Float32Array PCM (-1.0 to +1.0)</text>
          
          <!-- Audio nodes inside -->
          <rect x="260" y="150" width="100" height="45" rx="6" fill="#242836" stroke="#4ade80" stroke-width="1"/>
          <text x="310" y="178" text-anchor="middle" fill="#4ade80" font-size="9">GainNode</text>
          
          <rect x="260" y="210" width="100" height="45" rx="6" fill="#242836" stroke="#fbbf24" stroke-width="1"/>
          <text x="310" y="238" text-anchor="middle" fill="#fbbf24" font-size="9">BiquadFilter</text>
          
          <rect x="260" y="270" width="100" height="45" rx="6" fill="#242836" stroke="#f87171" stroke-width="1"/>
          <text x="310" y="298" text-anchor="middle" fill="#f87171" font-size="9">Analyser</text>
          
          <rect x="400" y="150" width="100" height="45" rx="6" fill="#242836" stroke="#c586c0" stroke-width="1"/>
          <text x="450" y="178" text-anchor="middle" fill="#c586c0" font-size="9">Compressor</text>
          
          <rect x="400" y="210" width="100" height="45" rx="6" fill="#242836" stroke="#9cdcfe" stroke-width="1"/>
          <text x="450" y="238" text-anchor="middle" fill="#9cdcfe" font-size="9">Convolver</text>
          
          <rect x="540" y="180" width="100" height="60" rx="6" fill="#242836" stroke="#e1e4ed" stroke-width="2"/>
          <text x="590" y="205" text-anchor="middle" fill="#e1e4ed" font-size="9">Destination</text>
          <text x="590" y="220" text-anchor="middle" fill="#8b90a0" font-size="8">(speakers)</text>
          
          <!-- Connection lines inside -->
          <path d="M360 172 L400 172" stroke="#8b90a0" stroke-width="1" stroke-dasharray="3,2"/>
          <path d="M500 172 L540 200" stroke="#8b90a0" stroke-width="1" stroke-dasharray="3,2"/>
          <path d="M360 232 L400 232" stroke="#8b90a0" stroke-width="1" stroke-dasharray="3,2"/>
          <path d="M500 232 L540 210" stroke="#8b90a0" stroke-width="1" stroke-dasharray="3,2"/>
          
          <!-- Output arrow -->
          <path d="M670 200 L720 200" stroke="#4ade80" stroke-width="2" marker-end="url(#arr-ctx)"/>
          
          <!-- Output -->
          <rect x="730" y="170" width="140" height="60" rx="8" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="800" y="195" text-anchor="middle" fill="#4ade80" font-size="10">Speaker Output</text>
          <text x="800" y="215" text-anchor="middle" fill="#8b90a0" font-size="9">PCM → DAC → Sound</text>
          
          <!-- Data format note -->
          <rect x="250" y="340" width="400" height="50" rx="8" fill="#242836"/>
          <text x="450" y="362" text-anchor="middle" fill="#9cdcfe" font-family="monospace" font-size="11">Float32Array: [0.0, 0.707, 1.0, 0.707, 0.0, -0.707, -1.0, ...]</text>
          <text x="450" y="380" text-anchor="middle" fill="#8b90a0" font-size="9">AudioContext uses 32-bit floats normalized to -1.0 to +1.0 range</text>
          
          <defs>
            <marker id="arr-ctx" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80"/>
            </marker>
          </defs>
        </svg>
        <p class="diagram-caption">AudioContext processes PCM through a graph of audio nodes</p>
      </div>


      <!-- ============================================ -->
      <!-- SECTION: Audio Element -->
      <!-- ============================================ -->
      <h2>What Does the Audio Element Read?</h2>

      <div class="key-point">
        <span class="key-point-icon">&#128161;</span>
        <p><strong>&lt;audio&gt; element handles encoded files!</strong> It decodes MP3, AAC, Opus, WAV, etc. internally and outputs PCM to speakers. You don't see the PCM directly.</p>
      </div>

      <div class="diagram">
        <svg viewBox="0 0 900 280" xmlns="http://www.w3.org/2000/svg">
          <text x="450" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">&lt;audio&gt; Element: High-Level Playback</text>
          
          <!-- Input files -->
          <text x="100" y="60" text-anchor="middle" fill="#8b90a0" font-size="11">Supported Formats</text>
          
          <rect x="30" y="75" width="140" height="35" rx="6" fill="#242836" stroke="#f87171" stroke-width="1"/>
          <text x="100" y="98" text-anchor="middle" fill="#f87171" font-size="10">.mp3 (compressed)</text>
          
          <rect x="30" y="115" width="140" height="35" rx="6" fill="#242836" stroke="#fbbf24" stroke-width="1"/>
          <text x="100" y="138" text-anchor="middle" fill="#fbbf24" font-size="10">.aac (compressed)</text>
          
          <rect x="30" y="155" width="140" height="35" rx="6" fill="#242836" stroke="#4ade80" stroke-width="1"/>
          <text x="100" y="178" text-anchor="middle" fill="#4ade80" font-size="10">.wav (PCM in container)</text>
          
          <rect x="30" y="195" width="140" height="35" rx="6" fill="#242836" stroke="#6c9cfc" stroke-width="1"/>
          <text x="100" y="218" text-anchor="middle" fill="#6c9cfc" font-size="10">.ogg / .webm (Opus)</text>
          
          <!-- Arrows -->
          <path d="M170 130 L220 150" stroke="#8b90a0" stroke-width="1.5"/>
          <path d="M170 170 L220 160" stroke="#8b90a0" stroke-width="1.5"/>
          
          <!-- Audio element box -->
          <rect x="230" y="90" width="300" height="140" rx="12" fill="#1a1d27" stroke="#c586c0" stroke-width="3"/>
          <text x="380" y="120" text-anchor="middle" fill="#c586c0" font-size="14" font-weight="600">&lt;audio&gt; Element</text>
          
          <!-- Internal decoder -->
          <rect x="260" y="140" width="120" height="60" rx="6" fill="#242836" stroke="#fbbf24" stroke-width="1"/>
          <text x="320" y="165" text-anchor="middle" fill="#fbbf24" font-size="10">Built-in Decoder</text>
          <text x="320" y="182" text-anchor="middle" fill="#8b90a0" font-size="8">MP3/AAC/Opus → PCM</text>
          
          <!-- Arrow inside -->
          <path d="M380 170 L420 170" stroke="#8b90a0" stroke-width="1.5" marker-end="url(#arr-audio)"/>
          
          <!-- PCM output inside -->
          <rect x="430" y="145" width="80" height="50" rx="6" fill="#242836" stroke="#4ade80" stroke-width="1"/>
          <text x="470" y="175" text-anchor="middle" fill="#4ade80" font-size="10">PCM</text>
          
          <!-- Output arrow -->
          <path d="M530 160 L580 160" stroke="#4ade80" stroke-width="2" marker-end="url(#arr-audio2)"/>
          
          <!-- Speaker -->
          <rect x="590" y="120" width="140" height="80" rx="8" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="660" y="150" text-anchor="middle" fill="#4ade80" font-size="11">Speakers</text>
          <text x="660" y="170" text-anchor="middle" fill="#8b90a0" font-size="9">PCM → DAC → Sound</text>
          <text x="660" y="185" text-anchor="middle" fill="#8b90a0" font-size="8">(you hear it!)</text>
          
          <!-- Note -->
          <rect x="250" y="240" width="400" height="30" rx="6" fill="#242836"/>
          <text x="450" y="260" text-anchor="middle" fill="#8b90a0" font-size="10">You don't see the PCM - the browser handles decoding internally</text>
          
          <defs>
            <marker id="arr-audio" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
              <polygon points="0 0, 8 3, 0 6" fill="#8b90a0"/>
            </marker>
            <marker id="arr-audio2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80"/>
            </marker>
          </defs>
        </svg>
        <p class="diagram-caption">The audio element decodes files internally - you just get playback controls</p>
      </div>

      <div class="code-block">
        <pre><span class="comment">// Using the &lt;audio&gt; element</span>

<span class="comment">// HTML</span>
&lt;<span class="keyword">audio</span> <span class="variable">id</span>=<span class="string">"player"</span> <span class="variable">controls</span>&gt;
  &lt;<span class="keyword">source</span> <span class="variable">src</span>=<span class="string">"song.mp3"</span> <span class="variable">type</span>=<span class="string">"audio/mpeg"</span>&gt;
  &lt;<span class="keyword">source</span> <span class="variable">src</span>=<span class="string">"song.ogg"</span> <span class="variable">type</span>=<span class="string">"audio/ogg"</span>&gt;
&lt;/<span class="keyword">audio</span>&gt;

<span class="comment">// JavaScript - simple playback control</span>
<span class="keyword">const</span> <span class="variable">audio</span> = <span class="variable">document</span>.<span class="function">getElementById</span>(<span class="string">'player'</span>);

<span class="variable">audio</span>.<span class="function">play</span>();           <span class="comment">// Start playback</span>
<span class="variable">audio</span>.<span class="function">pause</span>();          <span class="comment">// Pause</span>
<span class="variable">audio</span>.<span class="variable">currentTime</span> = <span class="number">30</span>;  <span class="comment">// Seek to 30 seconds</span>
<span class="variable">audio</span>.<span class="variable">volume</span> = <span class="number">0.5</span>;      <span class="comment">// 50% volume</span>

<span class="comment">// You CANNOT access the raw PCM data directly!</span>
<span class="comment">// The audio element handles decoding internally</span></pre>
      </div>

      <h3>Audio Element + AudioContext (Bridge)</h3>

      <p>To access PCM from an audio element, you need to connect it to AudioContext:</p>

      <div class="code-block">
        <pre><span class="comment">// Bridge: Audio element → AudioContext → PCM access</span>

<span class="keyword">const</span> <span class="variable">audio</span> = <span class="variable">document</span>.<span class="function">getElementById</span>(<span class="string">'player'</span>);
<span class="keyword">const</span> <span class="variable">audioCtx</span> = <span class="keyword">new</span> <span class="type">AudioContext</span>();

<span class="comment">// Create a source from the audio element</span>
<span class="keyword">const</span> <span class="variable">source</span> = <span class="variable">audioCtx</span>.<span class="function">createMediaElementSource</span>(<span class="variable">audio</span>);

<span class="comment">// Now you can analyze the PCM!</span>
<span class="keyword">const</span> <span class="variable">analyser</span> = <span class="variable">audioCtx</span>.<span class="function">createAnalyser</span>();
<span class="variable">analyser</span>.<span class="variable">fftSize</span> = <span class="number">2048</span>;

<span class="variable">source</span>.<span class="function">connect</span>(<span class="variable">analyser</span>);
<span class="variable">analyser</span>.<span class="function">connect</span>(<span class="variable">audioCtx</span>.<span class="variable">destination</span>);

<span class="comment">// Get PCM waveform data</span>
<span class="keyword">const</span> <span class="variable">pcmData</span> = <span class="keyword">new</span> <span class="type">Float32Array</span>(<span class="variable">analyser</span>.<span class="variable">fftSize</span>);
<span class="variable">analyser</span>.<span class="function">getFloatTimeDomainData</span>(<span class="variable">pcmData</span>);

<span class="variable">console</span>.<span class="function">log</span>(<span class="string">'PCM from audio element:'</span>, <span class="variable">pcmData</span>);
<span class="comment">// Float32Array(2048) [0.0234, 0.0567, ...]</span></pre>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Comparison -->
      <!-- ============================================ -->
      <h2>AudioContext vs Audio Element</h2>

      <table class="comparison-table">
        <thead>
          <tr>
            <th>Feature</th>
            <th>AudioContext</th>
            <th>&lt;audio&gt; Element</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>Data format</strong></td>
            <td>PCM (Float32Array)</td>
            <td>Encoded files (MP3, AAC, etc.)</td>
          </tr>
          <tr>
            <td><strong>Access to samples</strong></td>
            <td>Yes - direct PCM access</td>
            <td>No - decoding is internal</td>
          </tr>
          <tr>
            <td><strong>Processing</strong></td>
            <td>Full DSP (filters, effects, analysis)</td>
            <td>Basic (volume, playback rate)</td>
          </tr>
          <tr>
            <td><strong>Real-time input</strong></td>
            <td>Yes (microphone, streams)</td>
            <td>No (files only)</td>
          </tr>
          <tr>
            <td><strong>Use case</strong></td>
            <td>Audio apps, visualizers, games</td>
            <td>Simple media playback</td>
          </tr>
          <tr>
            <td><strong>Complexity</strong></td>
            <td>Higher (node graph)</td>
            <td>Lower (just play/pause)</td>
          </tr>
        </tbody>
      </table>

      <!-- ============================================ -->
      <!-- SECTION: WebRTC Context -->
      <!-- ============================================ -->
      <h2>In WebRTC Context</h2>

      <div class="diagram">
        <svg viewBox="0 0 900 200" xmlns="http://www.w3.org/2000/svg">
          <text x="450" y="25" text-anchor="middle" fill="#e1e4ed" font-size="14" font-weight="600">WebRTC Audio Flow: PCM ↔ Opus ↔ PCM</text>
          
          <!-- Sender side -->
          <rect x="30" y="60" width="100" height="60" rx="8" fill="#242836" stroke="#f87171" stroke-width="2"/>
          <text x="80" y="85" text-anchor="middle" fill="#f87171" font-size="10">Microphone</text>
          <text x="80" y="100" text-anchor="middle" fill="#8b90a0" font-size="8">PCM</text>
          
          <path d="M130 90 L170 90" stroke="#8b90a0" stroke-width="2" marker-end="url(#arr-rtc)"/>
          
          <rect x="180" y="60" width="100" height="60" rx="8" fill="#242836" stroke="#fbbf24" stroke-width="2"/>
          <text x="230" y="85" text-anchor="middle" fill="#fbbf24" font-size="10">Opus Encoder</text>
          <text x="230" y="100" text-anchor="middle" fill="#8b90a0" font-size="8">PCM → Opus</text>
          
          <path d="M280 90 L320 90" stroke="#8b90a0" stroke-width="2" marker-end="url(#arr-rtc)"/>
          
          <!-- Network -->
          <rect x="330" y="50" width="240" height="80" rx="8" fill="#1a1d27" stroke="#6c9cfc" stroke-width="2"/>
          <text x="450" y="80" text-anchor="middle" fill="#6c9cfc" font-size="11">Network (RTP Packets)</text>
          <text x="450" y="100" text-anchor="middle" fill="#8b90a0" font-size="9">Opus encoded frames (~40 bytes/20ms)</text>
          <text x="450" y="115" text-anchor="middle" fill="#8b90a0" font-size="8">Much smaller than PCM!</text>
          
          <path d="M570 90 L610 90" stroke="#8b90a0" stroke-width="2" marker-end="url(#arr-rtc)"/>
          
          <!-- Receiver side -->
          <rect x="620" y="60" width="100" height="60" rx="8" fill="#242836" stroke="#fbbf24" stroke-width="2"/>
          <text x="670" y="85" text-anchor="middle" fill="#fbbf24" font-size="10">Opus Decoder</text>
          <text x="670" y="100" text-anchor="middle" fill="#8b90a0" font-size="8">Opus → PCM</text>
          
          <path d="M720 90 L760 90" stroke="#8b90a0" stroke-width="2" marker-end="url(#arr-rtc)"/>
          
          <rect x="770" y="60" width="100" height="60" rx="8" fill="#242836" stroke="#4ade80" stroke-width="2"/>
          <text x="820" y="85" text-anchor="middle" fill="#4ade80" font-size="10">Speaker</text>
          <text x="820" y="100" text-anchor="middle" fill="#8b90a0" font-size="8">PCM</text>
          
          <!-- Labels -->
          <text x="130" y="160" text-anchor="middle" fill="#f87171" font-size="9">SENDER</text>
          <text x="450" y="160" text-anchor="middle" fill="#6c9cfc" font-size="9">NETWORK</text>
          <text x="770" y="160" text-anchor="middle" fill="#4ade80" font-size="9">RECEIVER</text>
          
          <text x="450" y="180" text-anchor="middle" fill="#8b90a0" font-size="10">PCM is used at endpoints; Opus travels over the network</text>
          
          <defs>
            <marker id="arr-rtc" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#8b90a0"/>
            </marker>
          </defs>
        </svg>
        <p class="diagram-caption">WebRTC converts PCM to Opus for transmission, then back to PCM for playback</p>
      </div>

      <!-- ============================================ -->
      <!-- SECTION: Key Takeaways -->
      <!-- ============================================ -->
      <h2>Key Takeaways</h2>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>PCM is the universal format</strong> &mdash; All audio starts and ends as PCM. Codecs just compress it for storage/transmission.</p>
      </div>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>AudioContext = Low-level PCM access</strong> &mdash; Use it when you need to process, analyze, or generate audio.</p>
      </div>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>&lt;audio&gt; element = High-level playback</strong> &mdash; Use it for simple file playback. Decoding happens internally.</p>
      </div>

      <div class="key-point">
        <span class="key-point-icon">&#9888;</span>
        <p><strong>Opus is king for real-time</strong> &mdash; 48x compression with excellent quality. That's why WebRTC uses it by default.</p>
      </div>

    </article>

    <footer class="doc-footer">
      <a href="../index.html">&larr; Back to all docs</a>
    </footer>
  </div>

</body>
</html>
